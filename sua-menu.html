<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω Menu | CAFREE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; background: #f3f4f6; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #6a11cb; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
        .btn-save { background: #27ae60; }
        .btn-back { background: #7f8c8d; }
        .btn-reset { background: #e67e22; }

        .menu-list { margin-top: 30px; border-top: 2px dashed #eee; padding-top: 20px; }
        .menu-item { display: flex; align-items: center; justify-content: space-between; background: #fafafa; padding: 10px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #eee; }
        .menu-item img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; margin-right: 10px; }
        .item-info { flex: 1; }
        .btn-delete { background: #e74c3c; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex: none;}
    </style>
</head>
<body>

<div class="container">
    <h2><i class="fa-solid fa-utensils"></i> QU·∫¢N L√ù MENU (GitHub Pages Mode)</h2>

    <div class="form-group">
        <label>T√™n m√≥n m·ªõi / c·∫ßn s·ª≠a:</label>
        <input type="text" id="name" placeholder="V√≠ d·ª•: Tr√† v·∫£i nhi·ªát ƒë·ªõi">
    </div>

    <div class="form-group">
        <label>Gi√° b√°n (VNƒê):</label>
        <input type="number" id="price" placeholder="V√≠ d·ª•: 35000">
    </div>

    <div class="form-group">
        <label>·∫¢nh m√≥n ƒÉn:</label>
        <input type="file" id="imgInput" accept="image/*">
        <small style="color:#666">Ch·ªçn ·∫£nh t·ª´ m√°y t√≠nh (·∫¢nh s·∫Ω ƒë∆∞·ª£c m√£ h√≥a v√† l∆∞u v√†o tr√¨nh duy·ªát)</small>
    </div>

    <div class="btn-group">
        <button class="btn-back" onclick="window.location.href='Trang Ch·ªß.html'">‚¨Ö Quay l·∫°i</button>
        <button class="btn-reset" onclick="resetDefault()">‚Ü∫ Kh√¥i ph·ª•c g·ªëc</button>
        <button class="btn-save" onclick="handleSave()">üíæ L∆ØU M√ìN</button>
    </div>

    <div class="menu-list">
        <h3>Danh s√°ch m√≥n hi·ªán t·∫°i (<span id="count">0</span>)</h3>
        <div id="listContainer"></div>
    </div>
</div>

<script>
    // D·ªØ li·ªáu m·∫´u (n·∫øu ch∆∞a c√≥ g√¨)
    const defaultMenu = [
        { name: "C√† ph√™ ƒëen", price: 15000, img: "https://via.placeholder.com/150?text=Cafe+Den" },
        { name: "C√† ph√™ s·ªØa", price: 18000, img: "https://via.placeholder.com/150?text=Cafe+Sua" }
    ];

    // H√†m hi·ªÉn th·ªã danh s√°ch
    function renderAdminList() {
        let menu = JSON.parse(localStorage.getItem('cafeMenu')) || defaultMenu;
        let container = document.getElementById("listContainer");
        document.getElementById("count").innerText = menu.length;
        container.innerHTML = "";

        menu.forEach((item, index) => {
            container.innerHTML += `
                <div class="menu-item">
                    <img src="${item.img}" onerror="this.src='https://via.placeholder.com/50'">
                    <div class="item-info">
                        <strong>${item.name}</strong><br>
                        ${item.price.toLocaleString()} ƒë
                    </div>
                    <button class="btn-delete" onclick="deleteItem(${index})" title="X√≥a m√≥n n√†y"><i class="fa-solid fa-trash"></i></button>
                </div>
            `;
        });
    }

    // H√†m x·ª≠ l√Ω l∆∞u (Logic ch√≠nh cho GitHub Pages)
    function handleSave() {
        let name = document.getElementById("name").value.trim();
        let price = parseInt(document.getElementById("price").value);
        let fileInput = document.getElementById("imgInput");
        
        if (!name || !price) { alert("Vui l√≤ng nh·∫≠p t√™n v√† gi√°!"); return; }

        // Ki·ªÉm tra xem ng∆∞·ªùi d√πng c√≥ ch·ªçn ·∫£nh m·ªõi kh√¥ng
        if (fileInput.files && fileInput.files[0]) {
            // N·∫øu c√≥ ch·ªçn ·∫£nh -> ƒê·ªçc ·∫£nh th√†nh m√£ Base64
            let reader = new FileReader();
            
            reader.onload = function(e) {
                let base64Image = e.target.result; // ƒê√¢y l√† chu·ªói m√£ h√≥a c·ªßa ·∫£nh
                saveToLocalStorage(name, price, base64Image); // G·ªçi h√†m l∆∞u
            }
            
            reader.readAsDataURL(fileInput.files[0]); // B·∫Øt ƒë·∫ßu ƒë·ªçc file
        } else {
            // N·∫øu kh√¥ng ch·ªçn ·∫£nh -> L∆∞u v·ªõi ·∫£nh r·ªóng ho·∫∑c gi·ªØ ·∫£nh c≈© (x·ª≠ l√Ω ·ªü b∆∞·ªõc sau)
            saveToLocalStorage(name, price, null);
        }
    }

    // H√†m l∆∞u v√†o LocalStorage
    function saveToLocalStorage(name, price, newImgBase64) {
        let menu = JSON.parse(localStorage.getItem('cafeMenu')) || defaultMenu;
        let index = menu.findIndex(i => i.name.toLowerCase() === name.toLowerCase());

        if (index >= 0) {
            // --- S·ª¨A M√ìN C≈® ---
            menu[index].price = price;
            // Ch·ªâ c·∫≠p nh·∫≠t ·∫£nh n·∫øu c√≥ ·∫£nh m·ªõi ƒë∆∞·ª£c ch·ªçn
            if (newImgBase64) {
                menu[index].img = newImgBase64;
            }
            alert("ƒê√£ c·∫≠p nh·∫≠t m√≥n: " + name);
        } else {
            // --- TH√äM M√ìN M·ªöI ---
            // N·∫øu kh√¥ng c√≥ ·∫£nh upload, d√πng ·∫£nh m·∫∑c ƒë·ªãnh online
            let finalImg = newImgBase64 ? newImgBase64 : "https://via.placeholder.com/150?text=No+Image";
            menu.push({ name, price, img: finalImg });
            alert("ƒê√£ th√™m m√≥n m·ªõi: " + name);
        }

        try {
            localStorage.setItem('cafeMenu', JSON.stringify(menu));
            renderAdminList();
            
            // Reset form
            document.getElementById("name").value = "";
            document.getElementById("price").value = "";
            document.getElementById("imgInput").value = ""; 
        } catch (e) {
            alert("L·ªói: ·∫¢nh qu√° l·ªõn, tr√¨nh duy·ªát kh√¥ng l∆∞u n·ªïi! H√£y ch·ªçn ·∫£nh nh·ªè h∆°n.");
        }
    }

    // H√†m x√≥a m√≥n
    function deleteItem(index) {
        if(confirm("X√≥a m√≥n n√†y nh√©?")) {
            let menu = JSON.parse(localStorage.getItem('cafeMenu')) || defaultMenu;
            menu.splice(index, 1);
            localStorage.setItem('cafeMenu', JSON.stringify(menu));
            renderAdminList();
        }
    }

    // H√†m kh√¥i ph·ª•c
    function resetDefault() {
        if(confirm("Kh√¥i ph·ª•c menu g·ªëc?")) {
            localStorage.setItem('cafeMenu', JSON.stringify(defaultMenu));
            renderAdminList();
        }
    }

    // Ch·∫°y khi m·ªü trang
    renderAdminList();
</script>

</body>
</html>