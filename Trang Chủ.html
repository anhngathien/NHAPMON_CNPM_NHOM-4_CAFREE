<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>CAFREE | B√°n H√†ng T·∫°i Qu·∫ßy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="styles.css"> 
<script src="scripts.js"></script>

<style>
/* CSS RI√äNG CHO TRANG POS */
*{box-sizing:border-box}
body{
    margin:0;
    font-family: Arial, sans-serif; 
    background:#f3f4f6;
    overflow: hidden; 
}
.pos-container{
    display:grid;
    grid-template-columns:240px 1fr 360px;
    height:100vh;
}

/* 1. SIDEBAR */
.sidebar{
    background:linear-gradient(180deg,#6a11cb,#2575fc);
    color:white;
    padding:20px;
    display: flex;
    flex-direction: column;
}
.sidebar h2{text-align:center;margin-bottom:30px}
.sidebar button{
    width:100%;
    padding:12px;
    margin-bottom:12px;
    border:none;
    border-radius:14px;
    background:rgba(255,255,255,0.2);
    color:white;
    cursor:pointer;
    text-align: left;
    font-size: 16px;
    transition: 0.3s;
}
.sidebar button:hover { background:rgba(255,255,255,0.4); }
.sidebar button i { margin-right: 10px; width: 20px;}

/* 2. MENU AREA */
.menu-area{
    padding:20px;
    overflow-y:auto;
    background: #f4f7f6;
}
/* --- S·ª¨A L·∫†I THANH MENU HEADER CHO ƒê·∫∏P --- */
.menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    
    /* C·ªë ƒë·ªãnh thanh n√†y khi cu·ªôn chu·ªôt */
    position: sticky;
    top: 0;
    z-index: 10;

    /* üëá GIAO DI·ªÜN M·ªöI üëá */
    background-color: #ffffff; /* N·ªÅn tr·∫Øng s·∫°ch s·∫Ω */
    padding: 15px 20px;        /* TƒÉng kho·∫£ng c√°ch cho tho√°ng */
    margin: -20px -20px 20px -20px; /* CƒÉn ch·ªânh ƒë·ªÉ thanh n√†y tr√†n ra s√°t m√©p */
    
    /* Hi·ªáu ·ª©ng b√≥ng m·ªù ƒë·ªï xu·ªëng d∆∞·ªõi gi√∫p thanh n·ªïi b·∫≠t */
    box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
    border-bottom: 1px solid #eee;
}

/* Ch·ªânh ch·ªØ "Menu" to v√† ƒë·∫πp h∆°n */
.menu-header h3 {
    margin: 0;
    color: #6a11cb; /* M√†u t√≠m tr√πng v·ªõi Sidebar */
    font-size: 24px;
    font-weight: 800;
    text-transform: uppercase; /* Ch·ªØ in hoa */
    letter-spacing: 1px;
}

/* Table Bar */
.table-bar{ display:flex; gap:10px; flex-wrap: wrap;}
.table-bar button{
    padding:10px 16px;
    border:none;
    border-radius:16px;
    background:#e5e7eb;
    font-weight:bold;
    cursor:pointer;
    transition: 0.2s;
}
.table-bar button:hover { background: #d1d5db; }
.table-bar button.active{
    background:#6a11cb;
    color:white;
    box-shadow: 0 4px 10px rgba(106, 17, 203, 0.4);
}
.table-bar button.has-order {
    border: 2px solid #27ae60;
    color: #27ae60;
}
.table-bar button.active.has-order {
    border: 2px solid white;
    color: white;
}

/* Grid M√≥n ƒÇn */
.menu-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:16px;
}
.card{
    background:white;
    border-radius:18px;
    box-shadow:0 4px 10px rgba(0,0,0,.05);
    overflow:hidden;
    cursor:pointer;
    transition:.3s;
    border: 1px solid transparent;
}
.card:hover{transform:translateY(-5px); border-color: #6a11cb;}
.card img{width:100%;height:120px; object-fit: cover;}
.card-body{padding:10px}
.price{color:#6a11cb;font-weight:bold; margin-top: 5px;}

/* 3. ORDER AREA */
.order-area{
    background:white;
    padding:20px;
    display:flex;
    flex-direction:column;
    border-left: 1px solid #ddd;
}
.order-header { text-align: center; border-bottom: 2px dashed #eee; padding-bottom: 15px;}
.order-list{flex:1;overflow-y:auto; padding-top: 10px;}
.order-item{
    display:flex;
    justify-content:space-between;
    align-items: center;
    margin-bottom:12px;
    padding-bottom: 12px;
    border-bottom: 1px solid #f0f0f0;
}
.qty-control{
    display:flex;
    align-items: center;
    gap:8px;
    margin-top: 4px;
}
.qty-btn{
    width: 24px; height: 24px;
    border:none; background:#eee;
    border-radius:50%; cursor:pointer;
    font-weight: bold;
}
.qty-btn:hover { background: #ddd; }
.remove-btn{color:#e74c3c;cursor:pointer; margin-left: 8px;}

.total-section{
    border-top: 2px solid #333;
    padding-top: 15px;
}
.total-row { display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-bottom: 15px;}
.btn-pay{
    width: 100%;
    padding:16px;
    border:none;
    border-radius:12px;
    background:#27ae60;
    color:white;
    font-size:16px;
    font-weight: bold;
    cursor:pointer;
    transition: 0.3s;
}
.btn-pay:hover { background: #219150; }

/* Responsive Mobile */
@media (max-width: 768px) {
    .pos-container { grid-template-columns: 1fr; height: auto;}
    .sidebar { display: none; }
    .order-area { height: 50vh; border-top: 5px solid #eee;}
}
/* --- CSS CHO MODAL THANH TO√ÅN --- */
.modal {
    display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
    position: fixed;
    z-index: 100;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.5); /* N·ªÅn m·ªù */
    justify-content: center;
    align-items: center;
}
.modal-content {
    background-color: white;
    padding: 25px;
    border-radius: 15px;
    width: 400px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
.pay-options {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
}
.pay-btn {
    padding: 10px 20px;
    border: 2px solid #ddd;
    border-radius: 10px;
    background: white;
    cursor: pointer;
    font-weight: bold;
    flex: 1;
    margin: 0 5px;
}
.pay-btn.active {
    border-color: #27ae60;
    color: #27ae60;
    background: #e8f8f5;
}
.pay-section { display: none; margin-top: 15px; }
.pay-section.active { display: block; }

/* Input ti·ªÅn m·∫∑t */
.money-input {
    width: 100%;
    padding: 12px;
    font-size: 18px;
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-bottom: 10px;
}
.change-info {
    font-size: 16px;
    color: #e74c3c;
    font-weight: bold;
    margin: 10px 0;
}
/* ·∫¢nh QR */
.qr-img {
    width: 180px !important;  /* !important: B·∫Øt bu·ªôc d√πng k√≠ch th∆∞·ªõc n√†y */
    height: 180px !important; /* C·ªë ƒë·ªãnh chi·ªÅu cao */
    object-fit: contain;
    margin: 15px auto; /* CƒÉn gi·ªØa v√† t·∫°o kho·∫£ng c√°ch tr√™n d∆∞·ªõi */
    display: block;    /* ƒê·ªÉ cƒÉn gi·ªØa ho·∫°t ƒë·ªông */
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Th√™m b√≥ng nh·∫π cho ƒë·∫πp */
}
.close-modal {
    margin-top: 15px;
    background: #aaa;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
}
</style>
</head>

<body>

<div class="pos-container">

    <div class="sidebar">
        <h2><i class="fa-solid fa-mug-hot"></i> CAFREE</h2>
        <button onclick="go('thong-tin-nhan-vien.html')"><i class="fa-solid fa-plus"></i> Th√¥ng tin nh√¢n vi√™n</button>
        <button onclick="go('Ghi ch√∫.html')"><i class="fa-solid fa-table"></i> Ghi ch√∫</button>
        <button onclick="go('thong-ke.html')"><i class="fa-solid fa-chart-line"></i> Th·ªëng k√™</button>
        <div style="flex:1"></div>
        <button onclick="go('giao di·ªán ƒëƒÉng nh·∫≠p.html')" style="background: rgba(231, 76, 60, 0.8);">
            <i class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t
        </button>
    </div>

    <div class="menu-area">
        <div class="menu-header">
            <h3>Menu</h3>
            <div class="table-bar" id="tableBar">
                <button onclick="selectTable(this, 'B1')">B√†n 1</button>
                <button onclick="selectTable(this, 'B2')">B√†n 2</button>
                <button onclick="selectTable(this, 'B3')">B√†n 3</button>
                <button onclick="selectTable(this, 'B4')">B√†n 4</button>
                <button onclick="selectTable(this, 'B5')">B√†n 5</button>
                <button onclick="selectTable(this, 'Mang v·ªÅ')" style="background: #e67e22; color: white;">Mang v·ªÅ</button>
            </div>
        </div>

        <div class="menu-grid">
            <div class="card" onclick="addItem('Tr√† s·ªØa xo√†i', 35000)">
    <img src="images/tra-sua-xoai.jpg" alt="Tr√† s·ªØa xo√†i" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† s·ªØa xo√†i</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Tr√† s·ªØa matcha', 35000)">
    <img src="images/tra-sua-matcha.jpg" alt="Tr√† s·ªØa matcha" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† s·ªØa matcha</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('S·ªØa t∆∞∆°i ƒë∆∞·ªùng n√¢u', 35000)">
    <img src="images/sua-tuoi-duong-nau.jpg" alt="S·ªØa t∆∞∆°i ƒë∆∞·ªùng n√¢u" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>S·ªØa t∆∞∆°i ƒë∆∞·ªùng n√¢u</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Tr√† s·ªØa ƒë√†o', 35000)">
    <img src="images/tra-sua-dao.jpg" alt="Tr√† s·ªØa ƒë√†o" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† s·ªØa ƒë√†o</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Tr√† s·ªØa th·∫°ch', 35000)">
    <img src="images/tra-sua-thach.jpg" alt="Tr√† s·ªØa th·∫°ch" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† s·ªØa th·∫°ch</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('T√†o ph·ªõ tr√† xanh', 35000)">
    <img src="images/tao-pho-tra-xanh.jpg" alt="T√†o ph·ªõ tr√† xanh" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>T√†o ph·ªõ tr√† xanh</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Tr√† s·ªØa kem cheese', 35000)">
    <img src="images/tra-sua-kem-cheese.jpg" alt="Tr√† s·ªØa kem cheese" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† s·ªØa kem cheese</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Tr√† xanh', 35000)">
    <img src="images/tra-xanh.jpg" alt="Tr√† xanh" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† xanh</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Smoothie d√¢u', 35000)">
    <img src="images/smoothie-dau.jpg" alt="Smoothie d√¢u" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Smoothie d√¢u</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Tr√† s·ªØa ƒë·∫≠u ƒë·ªè', 35000)">
    <img src="images/tra-sua-dau-do.jpg" alt="Tr√† s·ªØa ƒë·∫≠u ƒë·ªè" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† s·ªØa ƒë·∫≠u ƒë·ªè</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Tr√† √¥ long', 35000)">
    <img src="images/tra-o-long.jpg" alt="Tr√† √¥ long" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† √¥ long</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Tr√† s·ªØa oreo', 35000)">
    <img src="images/tra-sua-oreo.jpg" alt="Tr√† s·ªØa oreo" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† s·ªØa oreo</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>

<div class="card" onclick="addItem('Tr√† hoa nh√†i', 35000)">
    <img src="images/tra-hoa-nhai.jpg" alt="Tr√† hoa nh√†i" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
    <div class="card-body">
        <b>Tr√† hoa nh√†i</b>
        <div class="price">35.000 ƒë</div>
    </div>
</div>
            <div class="card" onclick="addItem('C√† ph√™ ƒëen',25000)">
                <img src="images/cafe-den.jpg" alt="C√† ph√™ ƒëen">
                <div class="card-body"><b>C√† ph√™ ƒëen</b><div class="price">25.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('C√† ph√™ s·ªØa',28000)">
                <img src="images/cafe-sua.jpg" alt="C√† ph√™ s·ªØa">
                <div class="card-body"><b>C√† ph√™ s·ªØa</b><div class="price">28.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('B·∫°c x·ªâu',30000)">
                <img src="images/bac-xiu.jpg" alt="B·∫°c x·ªâu">
                <div class="card-body"><b>B·∫°c x·ªâu</b><div class="price">30.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('Latte',35000)">
                <img src="images/latte.jpg" alt="Latte">
                <div class="card-body"><b>Latte</b><div class="price">35.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('Cappuccino',38000)">
                <img src="images/cappuccino.jpg" alt="Cappuccino">
                <div class="card-body"><b>Cappuccino</b><div class="price">38.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('Tr√† ƒë√†o',35000)">
                <img src="images/tra-dao.jpg" alt="Tr√† ƒë√†o">
                <div class="card-body"><b>Tr√† ƒë√†o</b><div class="price">35.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('Tr√† chanh',30000)">
                <img src="images/tra-chanh.jpg" alt="Tr√† chanh">
                <div class="card-body"><b>Tr√† chanh</b><div class="price">30.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('Tr√† s·ªØa',40000)">
                <img src="images/tra-sua.jpg" alt="Tr√† s·ªØa">
                <div class="card-body"><b>Tr√† s·ªØa</b><div class="price">40.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('Tr√† s·ªØa tr√¢n ch√¢u',45000)">
                <img src="images/tra-sua-tran-chau.jpg" alt="Tr√† s·ªØa tr√¢n ch√¢u">
                <div class="card-body"><b>Tr√† s·ªØa tr√¢n ch√¢u</b><div class="price">45.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('Sinh t·ªë xo√†i',45000)">
                <img src="images/sinh-to-xoai.jpg" alt="Sinh t·ªë xo√†i">
                <div class="card-body"><b>Sinh t·ªë xo√†i</b><div class="price">45.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('Smoothie d√¢u',45000)">
                <img src="images/smoothie-dau.jpg" alt="Smoothie d√¢u">
                <div class="card-body"><b>Sinh t·ªë d√¢u</b><div class="price">45.000 ƒë</div></div>
            </div>
            <div class="card" onclick="addItem('N∆∞·ªõc cam',35000)">
                <img src="images/nuoc-ep-cam.jpg" alt="N∆∞·ªõc √©p cam">
                <div class="card-body"><b>N∆∞·ªõc cam</b><div class="price">35.000 ƒë</div></div>
            </div>
        </div>
    </div>

    <div class="order-area">
        <div class="order-header">
            <h3 id="currentTableName">Ch·ªçn b√†n ƒë·ªÉ g·ªçi m√≥n</h3>
            <small id="orderTime">--:--</small>
        </div>
        
        <div id="orderList" class="order-list">
            <p style="text-align:center; color:#888; margin-top:50px;">Ch∆∞a c√≥ m√≥n n√†o</p>
        </div>

        <div class="total-section">
            <div class="total-row">
                <span>T·ªïng ti·ªÅn:</span>
                <span id="totalMoney">0 ƒë</span>
            </div>
            <button class="btn-pay" onclick="pay()">THANH TO√ÅN</button>
        </div>
    </div>

</div>

<script>
// ============================================
// LOGIC POS 
// ============================================

let tableOrders = {}; 
let currentTableId = null;

// H√†m ch·ªçn b√†n
function selectTable(btn, tableId){
    document.querySelectorAll(".table-bar button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    currentTableId = tableId;
    document.getElementById("currentTableName").innerText = "H√≥a ƒë∆°n: " + tableId;

    if (!tableOrders[tableId]) {
        tableOrders[tableId] = {};
    }

    renderOrder();
}

// H√†m th√™m m√≥n
function addItem(name, price){
    if(!currentTableId){
        alert("Vui l√≤ng ch·ªçn b√†n tr∆∞·ªõc khi g·ªçi m√≥n!");
        return;
    }

    let cart = tableOrders[currentTableId];
    if(!cart[name]) {
        cart[name] = { price: price, qty: 1 };
    } else {
        cart[name].qty++;
    }
    renderOrder();
    updateTableStatus();
}

// H√†m hi·ªÉn th·ªã danh s√°ch m√≥n (Render)
function renderOrder(){
    if (!currentTableId) return;

    let cart = tableOrders[currentTableId];
    let container = document.getElementById("orderList");
    let html = "";
    let total = 0;

    if (Object.keys(cart).length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888; margin-top:50px;">Ch∆∞a c√≥ m√≥n n√†o</p>';
        document.getElementById("totalMoney").innerText = "0 ƒë";
        return;
    }

    for (let name in cart) {
        let item = cart[name];
        let itemTotal = item.qty * item.price;
        total += itemTotal;

        html += `
        <div class="order-item">
            <div>
                <div style="font-weight:bold; font-size:15px;">${name}</div>
                <div class="qty-control">
                    <button class="qty-btn" onclick="updateQty('${name}', -1)">-</button>
                    <span>${item.qty}</span>
                    <button class="qty-btn" onclick="updateQty('${name}', 1)">+</button>
                    <div style="font-size:12px; color:#666; margin-left:5px;">x ${item.price.toLocaleString()}</div>
                </div>
            </div>
            <div>
                <div style="font-weight:bold;">${itemTotal.toLocaleString()} ƒë</div>
                <div style="text-align:right;"><i class="fa-solid fa-trash remove-btn" onclick="removeItem('${name}')"></i></div>
            </div>
        </div>
        `;
    }

    container.innerHTML = html;
    document.getElementById("totalMoney").innerText = total.toLocaleString() + " ƒë";
}

function updateQty(name, delta) {
    let cart = tableOrders[currentTableId];
    if(cart[name]) {
        cart[name].qty += delta;
        if (cart[name].qty <= 0) delete cart[name];
    }
    renderOrder();
    updateTableStatus();
}

function removeItem(name) {
    if (confirm("X√≥a m√≥n " + name + "?")) {
        let cart = tableOrders[currentTableId];
        delete cart[name];
        renderOrder();
        updateTableStatus();
    }
}

// ============================================
// LOGIC THANH TO√ÅN M·ªöI (MODAL)
// ============================================

// 1. H√†m m·ªü Popup khi ·∫•n n√∫t THANH TO√ÅN ·ªü ngo√†i
function pay() {
    if (!currentTableId) { alert("Ch∆∞a ch·ªçn b√†n!"); return; }
    
    let cart = tableOrders[currentTableId];
    if (Object.keys(cart).length === 0) {
        alert("B√†n n√†y ch∆∞a c√≥ m√≥n n√†o!");
        return;
    }

    // T√≠nh t·ªïng ti·ªÅn
    let total = 0;
    for(let k in cart) total += cart[k].qty * cart[k].price;

    // Hi·ªÉn th·ªã th√¥ng tin l√™n Modal
    document.getElementById("modalTableName").innerText = currentTableId;
    document.getElementById("modalTotalMoney").innerText = total.toLocaleString() + " ƒë";
    document.getElementById("modalTotalMoney").dataset.value = total; // L∆∞u gi√° tr·ªã s·ªë ƒë·ªÉ t√≠nh to√°n
    
    // Reset form ti·ªÅn m·∫∑t
    document.getElementById("customerPay").value = "";
    document.getElementById("changeText").innerText = "Ti·ªÅn th·ª´a: 0 ƒë";
    
    // M·ªü Modal
    document.getElementById("paymentModal").style.display = "flex";
}

// 2. H√†m ƒë√≥ng Popup
function closeModal() {
    document.getElementById("paymentModal").style.display = "none";
}

// 3. H√†m chuy·ªÉn ƒë·ªïi gi·ªØa Ti·ªÅn m·∫∑t v√† QR
function switchMethod(method) {
    // ·∫®n h·∫øt c√°c section
    document.querySelectorAll('.pay-section').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.pay-btn').forEach(el => el.classList.remove('active'));

    // Hi·ªán section ƒë∆∞·ª£c ch·ªçn
    if (method === 'cash') {
        document.getElementById('section-cash').classList.add('active');
        document.querySelectorAll('.pay-btn')[0].classList.add('active');
    } else {
        document.getElementById('section-qr').classList.add('active');
        document.querySelectorAll('.pay-btn')[1].classList.add('active');
    }
}

// 4. H√†m t√≠nh ti·ªÅn th·ª´a (khi nh·∫≠p ti·ªÅn kh√°ch ƒë∆∞a)
function calcChange() {
    let total = parseFloat(document.getElementById("modalTotalMoney").dataset.value);
    let customerPay = parseFloat(document.getElementById("customerPay").value) || 0;
    let change = customerPay - total;

    if (change >= 0) {
        document.getElementById("changeText").innerText = "Ti·ªÅn th·ª´a: " + change.toLocaleString() + " ƒë";
        document.getElementById("changeText").style.color = "#27ae60"; // M√†u xanh
    } else {
        document.getElementById("changeText").innerText = "Thi·∫øu: " + Math.abs(change).toLocaleString() + " ƒë";
        document.getElementById("changeText").style.color = "#e74c3c"; // M√†u ƒë·ªè
    }
}

// 5. H√†m X√°c nh·∫≠n thanh to√°n cu·ªëi c√πng
function confirmPayment(type) {
    let total = parseFloat(document.getElementById("modalTotalMoney").dataset.value);
    
    if (type === 'cash') {
        let customerPay = parseFloat(document.getElementById("customerPay").value) || 0;
        let change = customerPay - total;
        
        // Logic: N·∫øu kh√°ch ƒë∆∞a ƒë·ªß ho·∫∑c th·ª´a -> OK. N·∫øu thi·∫øu m√† v·∫´n ·∫•n -> V·∫´n cho qua (theo y√™u c·∫ßu c·ªßa b·∫°n)
        if (change >= 0) {
            alert(`Thanh to√°n TH√ÄNH C√îNG!\nTr·∫£ l·∫°i kh√°ch: ${change.toLocaleString()} ƒë`);
        } else {
            // Tr∆∞·ªùng h·ª£p kh√°ch ƒë∆∞a thi·∫øu nh∆∞ng v·∫´n b·∫•m thanh to√°n
             alert("Thanh to√°n th√†nh c√¥ng!");
        }
    } else {
        // Tr∆∞·ªùng h·ª£p chuy·ªÉn kho·∫£n
        alert("X√°c nh·∫≠n ƒë√£ nh·∫≠n ƒë∆∞·ª£c ti·ªÅn chuy·ªÉn kho·∫£n!\nThanh to√°n th√†nh c√¥ng.");
    }

    // X√≥a d·ªØ li·ªáu b√†n v√† ƒë√≥ng modal
    tableOrders[currentTableId] = {};
    renderOrder();
    updateTableStatus();
    closeModal();
}

function updateTableStatus() {
    let buttons = document.querySelectorAll(".table-bar button");
    let tableIdMap = {"B√†n 1": "B1", "B√†n 2": "B2", "B√†n 3": "B3", "B√†n 4": "B4", "B√†n 5": "B5"};
    buttons.forEach(btn => {
        let tId = tableIdMap[btn.innerText];
        if (tableOrders[tId] && Object.keys(tableOrders[tId]).length > 0) {
            btn.classList.add("has-order");
        } else {
            btn.classList.remove("has-order");
        }
    });
}
</script>
<div id="paymentModal" class="modal">
    <div class="modal-content">
        <h3>Thanh to√°n: <span id="modalTableName"></span></h3>
        
        <p style="color: #666; font-size: 14px; margin-bottom: 5px;">
            M√£ Hƒê: <span id="modalInvoiceCode" style="font-weight:bold; color:#000;">...</span>
        </p>

        <h2 id="modalTotalMoney" style="color:#27ae60">0 ƒë</h2>
        
        <p style="margin-top: -10px; margin-bottom: 20px; color: #666;">
            Gi·ªù thanh to√°n: <span id="modalPaymentTime" style="font-weight:bold; color:#333">--:--</span>
        </p>

        <div class="pay-options">
            <button class="pay-btn active" onclick="switchMethod('cash')">üíµ Ti·ªÅn m·∫∑t</button>
            <button class="pay-btn" onclick="switchMethod('qr')">üè¶ Chuy·ªÉn kho·∫£n</button>
        </div>

        <div id="section-cash" class="pay-section active">
            <input type="number" id="customerPay" class="money-input" placeholder="Nh·∫≠p ti·ªÅn kh√°ch ƒë∆∞a..." oninput="calcChange()">
            <div class="change-info" id="changeText">Ti·ªÅn th·ª´a: 0 ƒë</div>
            <button class="btn-pay" onclick="confirmPayment('cash')">X√ÅC NH·∫¨N THANH TO√ÅN</button>
        </div>

        <div id="section-qr" class="pay-section">
            <p>Qu√©t m√£ QR ƒë·ªÉ thanh to√°n</p>
            <img src="images/qr.jpg" class="qr-img" alt="QR Code" width="180" height="180">
            <button class="btn-pay" onclick="confirmPayment('qr')">ƒê√É CHUY·ªÇN KHO·∫¢N XONG</button>
        </div>

        <button class="close-modal" onclick="closeModal()">ƒê√≥ng l·∫°i</button>
    </div>
</div>
</body>
</html>
