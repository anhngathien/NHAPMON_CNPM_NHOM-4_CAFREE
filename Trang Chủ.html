<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>CAFREE | B√°n H√†ng T·∫°i Qu·∫ßy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="styles.css"> 
<script src="scripts.js"></script>

<style>
/* CSS RI√äNG CHO TRANG POS */
*{box-sizing:border-box}
body{
    margin:0;
    font-family: Arial, sans-serif; 
    background:#f3f4f6;
    overflow: hidden; 
}
.pos-container {
    display: grid;
    grid-template-columns: 240px 1fr 360px;
    height: calc(100vh - 60px); /* S·ª¨A D√íNG N√ÄY: Tr·ª´ ƒëi 60px */
}

/* 1. SIDEBAR */
.sidebar{
    background:linear-gradient(180deg,#6a11cb,#2575fc);
    color:white;
    padding:20px;
    display: flex;
    flex-direction: column;
}
.sidebar h2{text-align:center;margin-bottom:30px}
.sidebar button{
    width:100%;
    padding:12px;
    margin-bottom:12px;
    border:none;
    border-radius:14px;
    background:rgba(255,255,255,0.2);
    color:white;
    cursor:pointer;
    text-align: left;
    font-size: 16px;
    transition: 0.3s;
}
.sidebar button:hover { background:rgba(255,255,255,0.4); }
.sidebar button i { margin-right: 10px; width: 20px;}

/* 2. MENU AREA */
.menu-area{
    padding:20px;
    overflow-y:auto;
    background: #f4f7f6;
}
/* --- S·ª¨A L·∫†I THANH MENU HEADER CHO ƒê·∫∏P --- */
.menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    
    /* C·ªë ƒë·ªãnh thanh n√†y khi cu·ªôn chu·ªôt */
    position: sticky;
    top: 0;
    z-index: 10;

    /* üëá GIAO DI·ªÜN M·ªöI üëá */
    background-color: #ffffff; /* N·ªÅn tr·∫Øng s·∫°ch s·∫Ω */
    padding: 15px 20px;        /* TƒÉng kho·∫£ng c√°ch cho tho√°ng */
    margin: -20px -20px 20px -20px; /* CƒÉn ch·ªânh ƒë·ªÉ thanh n√†y tr√†n ra s√°t m√©p */
    
    /* Hi·ªáu ·ª©ng b√≥ng m·ªù ƒë·ªï xu·ªëng d∆∞·ªõi gi√∫p thanh n·ªïi b·∫≠t */
    box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
    border-bottom: 1px solid #eee;
}

/* Ch·ªânh ch·ªØ "Menu" to v√† ƒë·∫πp h∆°n */
.menu-header h3 {
    margin: 0;
    color: #6a11cb; /* M√†u t√≠m tr√πng v·ªõi Sidebar */
    font-size: 24px;
    font-weight: 800;
    text-transform: uppercase; /* Ch·ªØ in hoa */
    letter-spacing: 1px;
}

/* --- S·ª¨A L·∫†I CSS CHO TABLE BAR --- */
.table-bar {
    display: grid;              /* D√πng Grid cho ƒë·ªÅu */
    grid-template-columns: repeat(4, 1fr); /* Chia l√†m 4 c·ªôt b·∫±ng nhau */
    gap: 8px;                   /* Kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
    width: 100%;                /* Chi·∫øm h·∫øt kho·∫£ng tr·ªëng b√™n ph·∫£i */
    max-width: 450px;           /* Gi·ªõi h·∫°n chi·ªÅu r·ªông ƒë·ªÉ kh√¥ng b·ªã gi√£n qu√° */
}

.table-bar button {
    padding: 8px 5px;           /* Thu g·ªçn padding ƒë·ªÉ n√∫t nh·ªè g·ªçn */
    border: none;
    border-radius: 8px;         /* Bo g√≥c nh·∫π h∆°n cho g·ªçn */
    background: #e5e7eb;
    font-weight: bold;
    cursor: pointer;
    font-size: 13px;            /* Ch·ªØ v·ª´a ph·∫£i */
    transition: 0.2s;
    width: 100%;                /* N√∫t t·ª± gi√£n full √¥ */
    white-space: nowrap;        /* Kh√¥ng cho ch·ªØ xu·ªëng d√≤ng */
}

/* Hi·ªáu ·ª©ng khi di chu·ªôt v√† khi ch·ªçn */
.table-bar button:hover { background: #d1d5db; }
.table-bar button.active {
    background: #6a11cb;
    color: white;
    box-shadow: 0 2px 5px rgba(106, 17, 203, 0.3);
}

/* Ri√™ng n√∫t Mang v·ªÅ cho m√†u cam n·ªïi b·∫≠t */
.table-bar button.btn-takeaway {
    background: #e67e22; 
    color: white;
}
.table-bar button.btn-takeaway.active {
    background: #d35400; /* M√†u cam ƒë·∫≠m h∆°n khi ch·ªçn */
    border: 2px solid white;
}

/* N√∫t n√†o c√≥ kh√°ch (ƒëang order) th√¨ vi·ªÅn xanh */
.table-bar button.has-order {
    border: 2px solid #27ae60;
    color: #27ae60;
    background: #fff;
}
.table-bar button.active.has-order {
    border: 2px solid #fff;
    color: #fff;
    background: #27ae60;
}
/* Grid M√≥n ƒÇn */
.menu-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:16px;
}
.card{
    background:white;
    border-radius:18px;
    box-shadow:0 4px 10px rgba(0,0,0,.05);
    overflow:hidden;
    cursor:pointer;
    transition:.3s;
    border: 1px solid transparent;
}
.card:hover{transform:translateY(-5px); border-color: #6a11cb;}
.card img{width:100%;height:120px; object-fit: cover;}
.card-body{padding:10px}
.price{color:#6a11cb;font-weight:bold; margin-top: 5px;}

/* 3. ORDER AREA */
.order-area {
    background: white;
    padding: 20px;
    display: flex;
    flex-direction: column;
    border-left: 1px solid #ddd;

    /* üëá QUAN TR·ªåNG: TH√äM 2 D√íNG N√ÄY V√ÄO ƒê·ªÇ GI·ªöI H·∫†N CHI·ªÄU CAO üëá */
    height: 100%;       /* B·∫Øt bu·ªôc chi·ªÅu cao ph·∫£i b·∫±ng khung cha, kh√¥ng ƒë∆∞·ª£c d√†i h∆°n */
    overflow: hidden;   /* C·∫Øt b·ªè ph·∫ßn th·ª´a ƒë·ªÉ con lƒÉn b√™n trong ho·∫°t ƒë·ªông */
}
.order-header { text-align: center; border-bottom: 2px dashed #eee; padding-bottom: 15px;}
.order-list {
    flex: 1; 
    overflow-y: auto;   /* Con lƒÉn s·∫Ω hi·ªán ·ªü ƒë√¢y */
    padding-right: 5px; /* ƒê·ªÉ con lƒÉn kh√¥ng ƒë√® l√™n ch·ªØ */
}
.order-list::-webkit-scrollbar {
    width: 6px;
}
.order-list::-webkit-scrollbar-thumb {
    background-color: #ccc;
    border-radius: 4px;
}
.order-item{
    display:flex;
    justify-content:space-between;
    align-items: center;
    margin-bottom:12px;
    padding-bottom: 12px;
    border-bottom: 1px solid #f0f0f0;
}
.qty-control{
    display:flex;
    align-items: center;
    gap:8px;
    margin-top: 4px;
}
.qty-btn{
    width: 24px; height: 24px;
    border:none; background:#eee;
    border-radius:50%; cursor:pointer;
    font-weight: bold;
}
.qty-btn:hover { background: #ddd; }
.remove-btn{color:#e74c3c;cursor:pointer; margin-left: 8px;}

.total-section {
    border-top: 2px solid #333;
    padding-top: 15px;
    background: white;
}
.total-row { display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-bottom: 15px;}
.btn-pay{
    width: 100%;
    padding:16px;
    border:none;
    border-radius:12px;
    background:#27ae60;
    color:white;
    font-size:16px;
    font-weight: bold;
    cursor:pointer;
    transition: 0.3s;
}
.btn-pay:hover { background: #219150; }
.order-note {
    margin-top: 10px;
    padding: 10px 0;
    border-top: 1px dashed #ddd;
}
.order-note textarea {
    width: 100%;
    height: 50px;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 8px;
    resize: none;
    font-family: inherit;
    font-size: 14px;
    background: #fafafa;
}
.order-note textarea:focus {
    outline: none;
    border-color: #6a11cb; /* M√†u t√≠m theo theme c·ªßa b·∫°n */
    background: white;
}
/* Responsive Mobile */
@media (max-width: 768px) {
    .pos-container { grid-template-columns: 1fr; height: auto;}
    .sidebar { display: none; }
    .order-area { height: 50vh; border-top: 5px solid #eee;}
}
/* --- CSS CHO MODAL THANH TO√ÅN --- */
.modal {
    display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
    position: fixed;
    z-index: 100;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.5); /* N·ªÅn m·ªù */
    justify-content: center;
    align-items: center;
}
.modal-content {
    background-color: white;
    padding: 25px;
    border-radius: 15px;
    width: 400px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
.pay-options {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
}
.pay-btn {
    padding: 10px 20px;
    border: 2px solid #ddd;
    border-radius: 10px;
    background: white;
    cursor: pointer;
    font-weight: bold;
    flex: 1;
    margin: 0 5px;
}
.pay-btn.active {
    border-color: #27ae60;
    color: #27ae60;
    background: #e8f8f5;
}
.pay-section { display: none; margin-top: 15px; }
.pay-section.active { display: block; }

/* Input ti·ªÅn m·∫∑t */
.money-input {
    width: 100%;
    padding: 12px;
    font-size: 18px;
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-bottom: 10px;
}
.change-info {
    font-size: 16px;
    color: #e74c3c;
    font-weight: bold;
    margin: 10px 0;
}
/* ·∫¢nh QR */
.qr-img {
    width: 180px !important;  /* !important: B·∫Øt bu·ªôc d√πng k√≠ch th∆∞·ªõc n√†y */
    height: 180px !important; /* C·ªë ƒë·ªãnh chi·ªÅu cao */
    object-fit: contain;
    margin: 15px auto; /* CƒÉn gi·ªØa v√† t·∫°o kho·∫£ng c√°ch tr√™n d∆∞·ªõi */
    display: block;    /* ƒê·ªÉ cƒÉn gi·ªØa ho·∫°t ƒë·ªông */
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Th√™m b√≥ng nh·∫π cho ƒë·∫πp */
}
.close-modal {
    margin-top: 15px;
    background: #aaa;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
}
</style>
</head>

<body>
<div style="background: #333; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center;">
    <span id="welcomeMsg">ƒêang t·∫£i...</span> 
    <div>
        <button onclick="logout()" style="background: #c0392b; border: none; padding: 8px 15px; color: white; border-radius: 5px; cursor: pointer;">
            <i class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t
        </button>
    </div>
</div>

<script>
    // KI·ªÇM TRA ƒêƒÇNG NH·∫¨P & PH√ÇN QUY·ªÄN
    let currentUser = JSON.parse(sessionStorage.getItem('currentUser'));

    if (!currentUser) {
        // Ch∆∞a ƒëƒÉng nh·∫≠p m√† c·ªë v√†o -> ƒê√° v·ªÅ login
        alert("Vui l√≤ng ƒëƒÉng nh·∫≠p!");
        window.location.href = "login.html";
    } else {
        // Hi·ªÉn th·ªã t√™n
        document.getElementById("welcomeMsg").innerHTML = 
            `Xin ch√†o, <strong>${currentUser.name}</strong> (${currentUser.role === 'admin' ? 'B·∫°ch Nga' : 'Nh√¢n vi√™n'})`;

        // N·∫øu l√† Admin -> Hi·ªán n√∫t Qu·∫£n l√Ω
        if (currentUser.role === 'admin') {
            document.getElementById("btnMenu").style.display = "inline-block";
            document.getElementById("btnStaff").style.display = "inline-block";
        }
    }

    function logout() {
        if(confirm("B·∫°n mu·ªën ƒëƒÉng xu·∫•t?")) {
            sessionStorage.removeItem('currentUser');
            window.location.href = "login.html";
        }
    }
</script>
<div class="pos-container">

    <div class="sidebar">
        <h2><i class="fa-solid fa-mug-hot"></i> CAFREE</h2>
        
    <button id="btnNhanVien" onclick="go('thong-tin-nhan-vien.html')">
    <i class="fa-solid fa-user-tag"></i> Th√¥ng tin nh√¢n vi√™n
    </button>

        <button id="btnSuaMenu" onclick="go('sua-menu.html')">
            <i class="fa-solid fa-pen-to-square"></i> S·ª≠a Menu
        </button>

        <button id="btnThongKe" onclick="go('thong-ke.html')">
            <i class="fa-solid fa-chart-line"></i> Th·ªëng k√™
        </button>

    </div>

    <div class="menu-area">
        <div class="menu-header">
    <div class="header-left">
        <h3>Menu</h3>
        <div class="search-box">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="searchInput" placeholder="T√¨m nhanh m√≥n..." onkeyup="searchMenu()">
        </div>
    </div>

    <div class="table-bar" id="tableBar">
<button onclick="selectTable(this, 'B1')">B√†n 1</button>
    <button onclick="selectTable(this, 'B2')">B√†n 2</button>
    <button onclick="selectTable(this, 'B3')">B√†n 3</button>
    <button onclick="selectTable(this, 'B4')">B√†n 4</button>
    <button onclick="selectTable(this, 'B5')">B√†n 5</button>
    <button onclick="selectTable(this, 'B6')">B√†n 6</button> 
    <button onclick="selectTable(this, 'B7')">B√†n 7</button> 
    <button onclick="selectTable(this, 'Mang v·ªÅ')" style="background: #e67e22; color: white;">Mang v·ªÅ</button>
    </div>
</div>
        
        <div class="menu-grid"></div> 
        
    </div> 
    <div class="order-area">
        <div class="order-header">
            <h3 id="currentTableName">Ch·ªçn b√†n ƒë·ªÉ g·ªçi m√≥n</h3>
            <small id="orderTime">--:--</small>
        </div>
        
        <div id="orderList" class="order-list">
            <p style="text-align:center; color:#888; margin-top:50px;">Ch∆∞a c√≥ m√≥n n√†o</p>
        </div>
        
        <div class="order-note">
            <textarea id="noteInput" placeholder="Ghi ch√∫ (VD: √çt ƒë√°, kh√¥ng ƒë∆∞·ªùng...)"></textarea>
        </div>
        
        <div class="total-section">
            <div class="total-row">
                <span>T·ªïng ti·ªÅn:</span>
                <span id="totalMoney">0 ƒë</span>
            </div>
            <button class="btn-pay" onclick="pay()">THANH TO√ÅN</button>
        </div>
    </div>

</div>
<script src="scripts.js"></script>

<div id="paymentModal" class="modal">
    <div class="modal-content">
        <h3>Thanh to√°n: <span id="modalTableName"></span></h3>
        
        <p style="color: #666; font-size: 14px; margin-bottom: 5px;">
            M√£ Hƒê: <span id="modalInvoiceCode" style="font-weight:bold; color:#000;">...</span>
        </p>

        <h2 id="modalTotalMoney" style="color:#27ae60">0 ƒë</h2>
        
        <p style="margin-top: -10px; margin-bottom: 20px; color: #666;">
            Gi·ªù thanh to√°n: <span id="modalPaymentTime" style="font-weight:bold; color:#333">--:--</span>
        </p>

        <div class="pay-options">
            <button class="pay-btn active" onclick="switchMethod('cash')">üíµ Ti·ªÅn m·∫∑t</button>
            <button class="pay-btn" onclick="switchMethod('qr')">üè¶ Chuy·ªÉn kho·∫£n</button>
        </div>

        <div id="section-cash" class="pay-section active">
            <input type="number" id="customerPay" class="money-input" placeholder="Nh·∫≠p ti·ªÅn kh√°ch ƒë∆∞a..." oninput="calcChange()">
            <div class="change-info" id="changeText">Ti·ªÅn th·ª´a: 0 ƒë</div>
            
            <button class="btn-pay" onclick="confirmPayment('cash')" style="background: #00ff2298;">
                <i class="fa-solid fa-print"></i> IN H√ìA ƒê∆†N & HO√ÄN T·∫§T
            </button>
        </div>

        <div id="section-qr" class="pay-section">
            <p>Qu√©t m√£ QR ƒë·ªÉ thanh to√°n</p>
            <img src="images/qr.jpg" class="qr-img" alt="QR Code" width="180" height="180">
            
            <button class="btn-pay" onclick="confirmPayment('qr')" style="background: #00ff2298;">
                <i class="fa-solid fa-print"></i> IN H√ìA ƒê∆†N & HO√ÄN T·∫§T
            </button>
        </div>

        <button class="close-modal" onclick="closeModal()">ƒê√≥ng l·∫°i</button>
    </div>
</div>
</body>
</html>
