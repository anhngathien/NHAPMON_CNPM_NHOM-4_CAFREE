<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập | CAFREE</title>

    <style>
        /* Giữ nguyên CSS đẹp cũ của bạn */
        body { margin: 0; font-family: Arial, sans-serif; background: linear-gradient(135deg, #6a11cb, #2575fc); height: 100vh; display: flex; justify-content: center; align-items: center; }
        .login-box { width: 360px; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        h2 { text-align: center; margin-bottom: 25px; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 12px; border: 1px solid #ccc; font-size: 14px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #6a11cb; color: white; border: none; border-radius: 12px; font-size: 16px; cursor: pointer; transition: 0.3s; }
        button:hover { background: #560da8; }
        .error { margin-top: 12px; color: red; text-align: center; display: none; font-size: 13px; }
    </style>
</head>
<body>

<div class="login-box">
    <h2>CAFREE LOGIN</h2>
    <input type="text" id="username" placeholder="Tên đăng nhập (ví dụ: admin, nv1)">
    <input type="password" id="password" placeholder="Mật khẩu">
    <button onclick="handleLogin()">ĐĂNG NHẬP</button>
    <div class="error" id="errorMsg"></div>
</div>

<script>
    // 1. KHỞI TẠO DỮ LIỆU NHÂN VIÊN (Chỉ chạy lần đầu hoặc khi mất dữ liệu)
    const defaultUsers = [
        { username: "admin", password: "123", role: "admin", name: "Chủ Quán", shift: "Toàn thời gian", phone: "0909000111" },
        { username: "nv1", password: "1", role: "staff", name: "Nguyễn Văn A", shift: "Sáng (6h - 14h)", phone: "0912345678" },
        { username: "nv2", password: "1", role: "staff", name: "Trần Thị B", shift: "Chiều (14h - 22h)", phone: "0987654321" },
        { username: "nv3", password: "1", role: "staff", name: "Lê Văn C", shift: "Tối (18h - 23h)", phone: "0901234567" }
    ];

    // Lưu vào LocalStorage để các trang khác (như trang Quản lý nhân viên) có thể đọc được
    if (!localStorage.getItem('cafeUsers')) {
        localStorage.setItem('cafeUsers', JSON.stringify(defaultUsers));
    }

    function handleLogin() {
        const userIn = document.getElementById("username").value.trim();
        const passIn = document.getElementById("password").value.trim();
        const error = document.getElementById("errorMsg");

        // Lấy danh sách user từ LocalStorage
        let users = JSON.parse(localStorage.getItem('cafeUsers'));
        
        // Tìm người dùng khớp username và password
        let userFound = users.find(u => u.username === userIn && u.password === passIn);

        if (userFound) {
            // LƯU QUAN TRỌNG: Lưu người đang đăng nhập vào Session (Tắt trình duyệt là mất - an toàn)
            sessionStorage.setItem('currentUser', JSON.stringify(userFound));
            
            // Chuyển trang
            window.location.href = "Trang Chủ.html";
        } else {
            error.style.display = "block";
            error.innerText = "Sai tên đăng nhập hoặc mật khẩu!";
        }
    }

    // Sự kiện nhấn Enter để đăng nhập
    document.getElementById("password").addEventListener("keypress", function(event) {
        if (event.key === "Enter") handleLogin();
    });
</script>

</body>
</html>